{% extends 'base.html' %}

{% block title %}{{ item.name }} - Library of Things{% endblock %}

{% block content %}
<div class="row g-5">
    <div class="col-lg-6">
        <div class="card border-0 shadow-lg overflow-hidden">
            {% if item.image %}
            <img src="{{ item.image.url }}" class="img-fluid w-100" alt="{{ item.name }}"
                style="height: 500px; object-fit: cover;">
            {% else %}
            <div class="bg-light text-secondary d-flex flex-column align-items-center justify-content-center"
                style="height: 500px;">
                <i class="bi bi-image fs-1 opacity-25 mb-3"></i>
                <span class="text-muted">No Image Available</span>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="col-lg-6">
        <div class="ps-lg-4">
            <div class="d-flex align-items-center gap-2 mb-3">
                <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 rounded-pill">
                    <i class="bi bi-tag-fill me-1"></i> {{ item.category.name }}
                </span>
                <span
                    class="badge {% if item.status == 'AVAILABLE' and not current_reservation %}bg-success{% else %}bg-secondary{% endif %} bg-opacity-10 {% if item.status == 'AVAILABLE' and not current_reservation %}text-success{% else %}text-secondary{% endif %} px-3 py-2 rounded-pill">
                    <i class="bi bi-circle-fill me-1 small"></i>
                    {% if item.status == 'AVAILABLE' and current_reservation %}
                    On Loan until {{ current_reservation.end_date|date:"M d" }}
                    {% else %}
                    {{ item.get_status_display }}
                    {% endif %}
                </span>
            </div>

            <h1 class="display-4 fw-bold mb-4 text-dark">{{ item.name }}</h1>

            <div class="mb-5">
                <h5 class="text-uppercase text-muted small fw-bold mb-3">Description</h5>
                <p class="lead text-secondary">{{ item.description }}</p>
            </div>

            <div class="d-grid gap-3">
                {% if user.is_authenticated %}
                {% if user.is_staff and item.status == 'PENDING' %}
                <form action="{% url 'approve_item' item.id %}" method="post" class="mb-3">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-lg w-100 py-3 shadow-soft">
                        <i class="bi bi-check-circle-fill me-2"></i> Approve Item
                    </button>
                </form>
                {% endif %}

                {% if item.status == 'AVAILABLE' %}
                <a href="{% url 'reserve_item' item.id %}" class="btn btn-primary btn-lg py-3 shadow-soft">
                    <i class="bi bi-calendar-check me-2"></i>
                    {% if current_reservation %}
                    Reserve for Future
                    {% else %}
                    Reserve Now
                    {% endif %}
                </a>
                {% elif item.status == 'PENDING' %}
                <button class="btn btn-warning btn-lg py-3 text-dark" disabled>
                    <i class="bi bi-hourglass-split me-2"></i> Pending Approval
                </button>
                {% else %}
                <button class="btn btn-secondary btn-lg py-3" disabled>
                    <i class="bi bi-slash-circle me-2"></i> Currently Unavailable
                </button>
                {% endif %}
                {% else %}
                <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-primary btn-lg py-3 shadow-soft">
                    <i class="bi bi-box-arrow-in-right me-2"></i> Login to Reserve
                </a>
                {% endif %}

                {% if item.manual %}
                <a href="{{ item.manual.url }}" class="btn btn-outline-secondary btn-lg py-3" target="_blank">
                    <i class="bi bi-file-earmark-pdf me-2"></i> Download Manual
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}